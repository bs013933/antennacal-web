# 罗盘校准说明

## 已完成的改进

### 1. Android设备校准 🤖

针对小米10等Android设备，我已经实现了自动校准功能：

- **自动方向修正**：Android设备的`event.alpha`值与iOS定义不同，现在会自动进行`360 - alpha`转换
- **设备识别**：自动检测Android设备，特别标识小米手机
- **优化传感器处理**：区分绝对方向和相对方向传感器

### 2. 手动校准控件 🎯

在罗盘界面添加了手动微调功能：

```
校准偏移:  [-5°]  [当前偏移值]°  [+5°]  [重置]
```

**使用方法**：
1. 启动罗盘后，会在信息面板中看到"校准偏移"控件
2. 点击 `-5°` 按钮：逆时针调整5度
3. 点击 `+5°` 按钮：顺时针调整5度
4. 点击 `重置` 按钮：将偏移量归零

### 3. 改进的平滑算法 📊

- **扩大平滑窗口**：从3增加到8，更好地消除抖动
- **加权平均**：新数据权重更大，保持响应性
- **低通滤波**：忽略小于0.5度的微小变化
- **优化CSS动画**：使用更平滑的过渡效果（0.5秒 + cubic-bezier缓动）

## 小米手机使用指南

### 方法1：使用自动校准（推荐）
现在小米10手机应该已经能够正确显示方向了，因为我添加了自动校准逻辑。

### 方法2：手动微调
如果自动校准后仍有偏差：

1. 打开手机的指南针应用
2. 找到一个已知的方向（例如正北）
3. 在antennacal-web中启动罗盘
4. 对比两个应用的读数
5. 使用 +5°/-5° 按钮进行调整，直到读数一致

### 调试模式
如果需要查看更多技术信息，可以启用调试模式：
- 在`CompassAlignment.vue`中将`showDebug`设置为`true`
- 会显示：原始读数、传感器类型、设备信息

## 技术细节

### Android vs iOS 方向传感器差异

**iOS (Safari)**:
- 使用 `webkitCompassHeading`
- 直接返回罗盘方向（0-360度，0度为正北）

**Android (Chrome)**:
- 使用 `event.alpha`
- 定义：设备顶部指向的方向与正北的角度差
- **需要转换**：`正确方向 = 360 - alpha`

### 校准逻辑流程

```javascript
// 1. 获取原始传感器数据
let heading = event.alpha;

// 2. Android设备自动校准
if (isAndroid) {
  heading = 360 - heading;
}

// 3. 应用用户手动偏移
heading = heading + calibrationOffset;

// 4. 标准化到0-360范围
heading = heading % 360;
if (heading < 0) heading += 360;

// 5. 平滑处理
smoothedHeading = smoothHeading(heading);
```

## 测试建议

1. **在手机上测试**（电脑没有磁力计）
2. **在同一网络**下通过局域网IP访问
3. **授予传感器权限**
4. **对比手机自带指南针**进行验证

## 可能的问题

### 如果方向还是不准确：

1. **检查手机传感器校准**：
   - 打开手机自带的指南针应用
   - 按提示进行8字校准

2. **尝试手动微调**：
   - 使用校准控件进行±5度调整
   - 找到最佳偏移值

3. **环境干扰**：
   - 远离金属物体
   - 避免电磁干扰

4. **浏览器兼容性**：
   - 推荐使用Chrome浏览器
   - 确保浏览器版本较新

## 下一步优化建议

如果需要进一步改进：
- [ ] 添加偏移量保存到localStorage
- [ ] 支持1度精细调整
- [ ] 自动检测并建议偏移量
- [ ] 添加传感器质量指示器

---

**当前版本**: v2.0 - 已添加Android校准和手动微调功能
**测试状态**: 等待小米10手机验证
